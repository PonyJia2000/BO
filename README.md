### 代码解释与工作流程

#### **代码结构**
基于高斯过程回归（GPR）和期望改进（Expected Improvement, EI）的贝叶斯优化（Bayesian Optimization, BO）流程。其核心目标是通过迭代实验设计，高效搜索高维空间中的最优参数组合。

---

#### **关键模块与功能**

1. **初始实验设计（Sobol序列生成）**
   - **输入参数**：用户定义因子数量、名称、取值范围及Sobol点数。
   - **实现**：
     - 使用scipy.stats.qmc.Sobol生成低差异序列（空间填充设计）。
     - 将点归一化到[0,1]后缩放到实际范围，保留两位小数。
   - **输出**：生成BO_Exp_Table.xlsx文件，包含：
     - MIN/MAX行定义变量范围。
     - 初始实验点（用户需手动填写实验结果）。

2. **高斯过程模型（GPR）**
   - **核函数**：Matérn 5/2（适合非平滑函数） + 白噪声核（防止过拟合）。
   - **训练**：使用GPy库优化超参数（长度尺度、方差），采用L-BFGS-B优化器。
   - **归一化**：输入（Min-Max）和输出（Z-Score）标准化以提高数值稳定性。

3. **贝叶斯优化循环**
   - **采集函数**：期望改进（EI）。
   - **优化策略**：
     - 使用CMA-ES（进化策略）最大化EI。
     - 若CMA-ES失败，回退到随机采样并检查与历史点的最小距离（min_dist_to_existing）。
   - **动态调整**：
     - 每次迭代衰减xi（默认衰减因子0.95，最小0.01）。
     - 根据建议点密度调整最小距离阈值（reject_rad_norm_for_suggestions）。
   
4. **收敛性检查**
   - **提前终止条件**：
     - 最大EI低于阈值（默认1e-7）。
     - 预测最优值连续多次停滞（默认容忍3次）。
   - **异常处理**：捕获CMA-ES失败、数值不稳定等情况。

5. **结果输出**
   - 新建议点追加到BO_Exp_Table.xlsx，标记为SUGGESTED_BY_BO_PENDING_RUN。
   - 输出文件保存至GP_BO_Results/BO_Result_CycleEnd.xlsx。

---

#### **工作流程图示**

```plaintext
开始
│
├─→ 生成初始设计？→ 是 → 输入参数 → Sobol序列生成 → 保存Excel → 退出
│
└─→ 否 → 读取Excel数据 → 训练GP模型 → BO循环：
     │
     ├─→ 迭代优化：
     │   ├─→ 计算EI → CMA-ES最大化 → 建议新点
     │   ├─→ 检查与历史点距离 → 拒绝过近的点
     │   └─→ 更新xi，检查收敛性
     │
     └─→ 保存建议点 → 结束
```

---

